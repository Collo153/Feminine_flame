<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin | Feminine Flame</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>

{% if page == 'login' %}
  <!-- LOGIN PAGE -->
  <div class="login-container">
    <div class="login-box">
      <h2>Admin Login</h2>
      <form method="POST">
        <input type="email" name="email" placeholder="Email" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit">Login</button>
      </form>
    </div>
  </div>

{% else %}
  <!-- ADMIN DASHBOARD -->
  <div class="admin-container">
    <!-- Header -->
    <header class="admin-header">
      <h1>Feminine Flame Admin</h1>
      <a href="{{ url_for('admin', action='logout') }}" class="btn btn-logout">Logout</a>
    </header>

    <!-- Main Content -->
    <div class="admin-main">
      <!-- Sidebar -->
      <aside class="admin-sidebar">
        <button onclick="showSection('products')" class="sidebar-btn active">Products</button>
        <!-- Add more buttons later: Orders, Messages -->
      </aside>

      <!-- Content Area -->
      <main class="admin-content">
        {% if edit_product %}
          <!-- EDIT PRODUCT FORM -->
          <div class="form-container">
            <h2>Edit Product</h2>
            <form method="POST">
              <input type="hidden" name="product_id" value="{{ edit_product._id }}">
              <div class="form-group"><input name="name" value="{{ edit_product.name }}" placeholder="Name" required></div>
              <div class="form-group"><textarea name="description" placeholder="Description">{{ edit_product.description }}</textarea></div>
              <div class="form-group">
                <select name="category">
                  <option value="perfume" {% if edit_product.category == 'perfume' %}selected{% endif %}>Perfume</option>
                  <option value="ebook" {% if edit_product.category == 'ebook' %}selected{% endif %}>eBook</option>
                </select>
              </div>
              <div class="form-group"><input type="number" step="0.01" name="price" value="{{ edit_product.price }}" placeholder="Price" required></div>
              <div class="form-group"><input type="number" name="stock" value="{{ edit_product.stock if edit_product.stock != -1 else '10' }}" placeholder="Stock"></div>
              <div class="form-group"><input name="image_url" value="{{ edit_product.image_url }}" placeholder="Image URL"></div>
              <button type="submit" class="btn btn-primary">Update Product</button>
              <a href="{{ url_for('admin') }}" class="btn btn-secondary">Cancel</a>
            </form>
          </div>

        {% else %}
          <!-- PRODUCT LIST + ADD FORM -->
          <div class="section-header">
            <h2>Products</h2>
            <button class="btn btn-primary" onclick="document.getElementById('add-form').style.display='block'">+ Add Product</button>
          </div>

          <!-- Add Product Form (Hidden by default) -->
          <div id="add-form" class="form-container" style="display:none;">
            <h3>Add New Product</h3>
            <form method="POST">
              <div class="form-group"><input name="name" placeholder="Name" required></div>
              <div class="form-group"><textarea name="description" placeholder="Description"></textarea></div>
              <div class="form-group">
                <select name="category">
                  <option value="perfume">Perfume</option>
                  <option value="ebook">eBook</option>
                </select>
              </div>
              <div class="form-group"><input type="number" step="0.01" name="price" placeholder="Price" required></div>
              <div class="form-group"><input type="number" name="stock" placeholder="Stock (for perfumes)"></div>
              <div class="form-group"><input name="image_url" placeholder="Image URL (e.g., /static/images/vb.jpg)"></div>
              <button type="submit" class="btn btn-primary">Add Product</button>
              <button type="button" class="btn btn-secondary" onclick="this.closest('.form-container').style.display='none'">Cancel</button>
            </form>
          </div>

          <!-- Products Table -->
          <table class="data-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Price</th>
                <th>Category</th>
                <th>Image</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for p in products %}
              <tr>
                <td>{{ p.name }}</td>
                <td>${{ "%.2f"|format(p.price) }}</td>
                <td>{{ p.category }}</td>
                <td>
                  {% if p.image_url %}
                    <img src="{{ p.image_url }}" width="50">
                  {% endif %}
                </td>
                <td>
                  <a href="{{ url_for('admin', edit=p._id) }}" class="btn btn-edit">Edit</a>
                  <a href="{{ url_for('admin', action='delete', id=p._id) }}" class="btn btn-delete" onclick="return confirm('Delete?')">Delete</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
      </main>
    </div>
  </div>
{% endif %}

</body>
</html>